<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GazDispo - G√©rant</title>
    <style>
        :root {
            --burkinabe-green: #00A651;
            --burkinabe-red: #EF2B2D;
            --burkinabe-yellow: #FCD116;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, var(--burkinabe-red) 0%, var(--burkinabe-green) 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 700px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 3px solid var(--burkinabe-yellow);
            padding-bottom: 1rem;
        }
        
        .header h1 {
            color: var(--burkinabe-green);
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .logo-mini {
            width: 40px;
            height: 40px;
            background: var(--burkinabe-green);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        
        input:focus {
            outline: none;
            border-color: var(--burkinabe-green);
        }
        
        .btn {
            background: var(--burkinabe-green);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #008C45;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,166,81,0.3);
        }
        
        .station-card {
            background: #F8F9FA;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--burkinabe-yellow);
        }
        
        .station-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--burkinabe-green);
            margin-bottom: 0.5rem;
        }
        
        .brand-group {
            background: white;
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 0.8rem;
            border-left: 3px solid var(--burkinabe-green);
        }
        
        .brand-name {
            font-weight: bold;
            color: var(--burkinabe-green);
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }
        
        .format-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.8rem;
            padding: 0.8rem;
            background: #F8F9FA;
            border-radius: 8px;
        }
        
        .format-row input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .format-row .format-label {
            min-width: 80px;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .status-toggle {
            display: flex;
            gap: 0.5rem;
        }
        
        .status-toggle label {
            padding: 0.5rem 1rem;
            background: white;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .status-toggle label:hover {
            border-color: var(--burkinabe-green);
        }
        
        .status-toggle input[type="radio"]:checked + span {
            color: var(--burkinabe-green);
        }
        
        .status-toggle input[type="radio"] {
            width: 18px;
            height: 18px;
        }
        
        .hidden { display: none; }
        
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--burkinabe-green);
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: bold;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .toast.error {
            background: var(--burkinabe-red);
        }
        
        .hint {
            background: #E8F5E9;
            padding: 1rem;
            border-radius: 8px;
            color: #2C3E50;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--burkinabe-green);
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1><span class="logo-mini">üî•</span> Acc√®s G√©rant</h1>
        <p style="color:#666;">Mettez √† jour votre station</p>
    </div>
    
    <div id="loginBox">
        <div class="hint">‚ÑπÔ∏è Entrez le code fourni par l'administrateur GazDispo</div>
        <input type="text" id="codeInput" placeholder="Code station (ex: station_...)">
        <button class="btn" onclick="login()">Se connecter</button>
    </div>
    
    <div id="dashboard" class="hidden">
        <div id="stationInfo"></div>
        <div id="brandsContainer"></div>
        <button class="btn" onclick="saveChanges()">üíæ Sauvegarder</button>
        <button class="btn" onclick="logout()" style="background:#7F8C8D;margin-top:1rem;">D√©connexion</button>
    </div>
</div>

<script src="firebase-app.js"></script>
<script src="firebase-database.js"></script>

<script>
firebase.initializeApp({
    apiKey:"AIzaSyAPRPagTMM5etUPT7T-rBgKikV2QmVHoAQ",
    authDomain:"gazdispo-5a9b1.firebaseapp.com",
    databaseURL:"https://gazdispo-5a9b1-default-rtdb.europe-west1.firebasedatabase.app",
    projectId:"gazdispo-5a9b1",
    storageBucket:"gazdispo-5a9b1.firebasestorage.app",
    messagingSenderId:"815895848815",
    appId:"1:815895848815:web:d6fdc94accc1f670ac6a9a"
});
var db = firebase.database();
var currentStation = null;

var BRANDS = {
    'sodigaz':{name:'SODIGAZ',formats:['3kg','6kg','12kg','35kg']},
    'total':{name:'TotalEnergies',formats:['6kg','12kg','35kg']},
    'oryx':{name:'Oryx Energy',formats:['6kg','12kg','35kg']},
    'shell':{name:'Shell',formats:['6kg','12kg']},
    'pegaz':{name:'P√©gaz',formats:['6kg','12kg']},
    'petrofa':{name:'Petrofa',formats:['6kg','12kg','35kg']},
    'ecogaz':{name:'Ecogaz',formats:['6kg','12kg']}
};

function login() {
    var id = document.getElementById('codeInput').value.trim();
    if (!id) { showToast('Entrez votre code', true); return; }
    
    db.ref('stations/'+id).once('value').then(function(s) {
        if (s.exists()) {
            currentStation = s.val();
            showDashboard();
        } else {
            showToast('Code invalide', true);
        }
    });
}

function showDashboard() {
    document.getElementById('loginBox').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');
    
    var h = '<div class="station-card">';
    h += '<div class="station-name">' + currentStation.name + '</div>';
    h += '<div style="color:#666;margin-bottom:0.3rem;">üìç ' + currentStation.address + '</div>';
    if (currentStation.phone) h += '<div style="color:#00A651;">üìû ' + currentStation.phone + '</div>';
    h += '</div>';
    document.getElementById('stationInfo').innerHTML = h;
    
    h = '<div style="background:#F8F9FA;border-radius:10px;padding:1rem;margin-bottom:1rem;">';
    h += '<h3 style="color:#00A651;margin-bottom:1rem;">üì¶ Marques et formats</h3>';
    
    for (var bid in BRANDS) {
        var b = BRANDS[bid];
        h += '<div class="brand-group"><div class="brand-name">'+b.name+'</div>';
        for (var i = 0; i < b.formats.length; i++) {
            var fmt = b.formats[i];
            var fid = bid+'_'+fmt;
            var chk = currentStation.brands && currentStation.brands[bid] && currentStation.brands[bid][fmt];
            var st = chk ? currentStation.brands[bid][fmt] : 'available';
            h += '<div class="format-row">';
            h += '<input type="checkbox" id="c_'+fid+'" '+(chk?'checked':'')+' onchange="toggle(\''+fid+'\')">';
            h += '<span class="format-label">'+fmt+'</span>';
            h += '<div class="status-toggle" id="s_'+fid+'" style="display:'+(chk?'flex':'none')+';">';
            h += '<label><input type="radio" name="r_'+fid+'" value="available" '+(st==='available'?'checked':'')+'><span>Dispo</span></label>';
            h += '<label><input type="radio" name="r_'+fid+'" value="unavailable" '+(st==='unavailable'?'checked':'')+'><span>Rupture</span></label>';
            h += '</div></div>';
        }
        h += '</div>';
    }
    h += '</div>';
    document.getElementById('brandsContainer').innerHTML = h;
}

function toggle(fid) {
    document.getElementById('s_'+fid).style.display = document.getElementById('c_'+fid).checked ? 'flex' : 'none';
}

function saveChanges() {
    var brands = {};
    for (var bid in BRANDS) {
        for (var i = 0; i < BRANDS[bid].formats.length; i++) {
            var fmt = BRANDS[bid].formats[i], fid = bid+'_'+fmt;
            var chk = document.getElementById('c_'+fid);
            if (chk && chk.checked) {
                if (!brands[bid]) brands[bid] = {};
                var radios = document.getElementsByName('r_'+fid), st = 'available';
                for (var j = 0; j < radios.length; j++) {
                    if (radios[j].checked) { st = radios[j].value; break; }
                }
                brands[bid][fmt] = st;
            }
        }
    }
    
    if (Object.keys(brands).length === 0) {
        showToast('S√©lectionnez au moins 1 format', true);
        return;
    }
    
    db.ref('stations/'+currentStation.id).update({
        brands:brands,
        updatedAt:Date.now()
    }).then(function() {
        showToast('‚úÖ Sauvegard√© !');
    });
}

function logout() {
    currentStation = null;
    document.getElementById('loginBox').classList.remove('hidden');
    document.getElementById('dashboard').classList.add('hidden');
    document.getElementById('codeInput').value = '';
}

function showToast(msg, isError) {
    var t = document.createElement('div');
    t.className = 'toast' + (isError ? ' error' : '');
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(function() { t.remove(); }, 3000);
}
</script>
</body>
</html>
