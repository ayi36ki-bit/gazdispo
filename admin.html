<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GazDispo - Admin</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .header { background: #00A651; color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 1.3rem; }
        .btn-back { color: white; text-decoration: none; background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: 20px; }
        .main { padding: 1.5rem; max-width: 800px; margin: 0 auto; }
        .card { background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .card h2 { margin-bottom: 1rem; color: #2C3E50; border-bottom: 2px solid #eee; padding-bottom: 0.5rem; }
        input, select { width: 100%; padding: 0.8rem; border: 2px solid #E0E0E0; border-radius: 8px; font-size: 1rem; margin-bottom: 0.8rem; }
        input:focus, select:focus { outline: none; border-color: #00A651; }
        .coords { display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem; }
        .coords input { margin-bottom: 0; }
        .btn-add { background: #00A651; color: white; border: none; padding: 1rem; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; width: 100%; margin-top: 0.5rem; }
        .btn-add:hover { background: #008C45; }
        .hint { background: #E8F5E9; padding: 0.8rem; border-radius: 8px; font-size: 0.9rem; color: #2C3E50; margin-bottom: 0.8rem; border-left: 4px solid #00A651; }
        .station { background: #FAFAFA; border-radius: 10px; padding: 1rem; margin-bottom: 0.8rem; border-left: 4px solid #00A651; }
        .station-name { font-weight: bold; font-size: 1.1rem; margin-bottom: 0.3rem; }
        .station-address { color: #7F8C8D; font-size: 0.9rem; margin-bottom: 0.8rem; }
        .station-btns { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .btn-status { padding: 0.5rem 0.8rem; border-radius: 6px; border: 2px solid; font-size: 0.85rem; font-weight: bold; cursor: pointer; background: white; }
        .btn-available { border-color: #00A651; color: #00A651; }
        .btn-available.active { background: #00A651; color: white; }
        .btn-limited { border-color: #FCD116; color: #D4A017; }
        .btn-limited.active { background: #FCD116; color: white; }
        .btn-unavailable { border-color: #EF2B2D; color: #EF2B2D; }
        .btn-unavailable.active { background: #EF2B2D; color: white; }
        .btn-delete { padding: 0.5rem 0.8rem; border-radius: 6px; border: none; background: #FF6B6B; color: white; font-size: 0.85rem; cursor: pointer; }
        .login-box { max-width: 400px; margin: 3rem auto; background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; }
        .login-box h2 { margin-bottom: 1.5rem; }
        .btn-login { background: #00A651; color: white; border: none; padding: 1rem; border-radius: 8px; font-size: 1rem; cursor: pointer; width: 100%; }
        .hidden { display: none !important; }
        .toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: #00A651; color: white; padding: 1rem 2rem; border-radius: 8px; font-weight: bold; z-index: 9999; }
        .status-badge { display: inline-block; padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.8rem; font-weight: bold; margin-bottom: 0.5rem; }
        .badge-available { background: #E8F5E9; color: #00A651; }
        .badge-limited { background: #FFFDE7; color: #D4A017; }
        .badge-unavailable { background: #FFEBEE; color: #EF2B2D; }
        #status { padding: 1rem; text-align: center; color: #7F8C8D; font-style: italic; }
    </style>
</head>
<body>

<header class="header">
    <h1>‚öôÔ∏è Administration GazDispo</h1>
    <a href="index.html" class="btn-back">‚Üê Retour</a>
</header>

<div id="loginBox" class="main">
    <div class="login-box">
        <h2>üîê Connexion Admin</h2>
        <input type="password" id="passwordInput" placeholder="Mot de passe">
        <button class="btn-login" onclick="login()">Se connecter</button>
        <p style="margin-top:1rem;color:#999;font-size:0.9rem;">Mot de passe: <strong>admin123</strong></p>
    </div>
</div>

<div id="adminBox" class="main hidden">
    <div id="status">Connexion Firebase...</div>
    <div class="card">
        <h2>‚ûï Ajouter un point de vente</h2>
        <input type="text" id="nom" placeholder="Nom de la station">
        <input type="text" id="adresse" placeholder="Adresse / Quartier">
        <div class="coords">
            <input type="number" id="lat" placeholder="Latitude (ex: 12.37)" step="0.000001">
            <input type="number" id="lng" placeholder="Longitude (ex: -1.52)" step="0.000001">
        </div>
        <div class="hint">üí° Google Maps ‚Üí Clic droit sur l'endroit ‚Üí 1√®re ligne = coordonn√©es</div>
        <select id="statut">
            <option value="available">‚úÖ Disponible</option>
            <option value="limited">‚ö†Ô∏è Stock limit√©</option>
            <option value="unavailable">‚ùå Rupture</option>
        </select>
        <button class="btn-add" onclick="ajouterStation()">‚ûï Ajouter la station</button>
    </div>
    <div class="card">
        <h2>üìã Gestion des stations</h2>
        <div id="listeStations">
            <p style="text-align:center;padding:1rem;color:#999;">Chargement...</p>
        </div>
    </div>
</div>

<script src="firebase-app.js"></script>
<script src="firebase-database.js"></script>

<script>
var firebaseConfig = {
    apiKey: "AIzaSyAPRPagTMM5etUPT7T-rBgKikV2QmVHoAQ",
    authDomain: "gazdispo-5a9b1.firebaseapp.com",
    databaseURL: "https://gazdispo-5a9b1-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "gazdispo-5a9b1",
    storageBucket: "gazdispo-5a9b1.firebasestorage.app",
    messagingSenderId: "815895848815",
    appId: "1:815895848815:web:d6fdc94accc1f670ac6a9a"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

function login() {
    var pwd = document.getElementById('passwordInput').value;
    if (pwd === 'admin123') {
        document.getElementById('loginBox').classList.add('hidden');
        document.getElementById('adminBox').classList.remove('hidden');
        connecterFirebase();
    } else {
        alert('Mot de passe incorrect !');
    }
}

function connecterFirebase() {
    document.getElementById('status').textContent = 'Connexion Firebase...';
    db.ref('stations').on('value', function(snapshot) {
        document.getElementById('status').textContent = '‚úÖ Firebase connect√© !';
        var data = snapshot.val();
        afficherStations(data);
    }, function(error) {
        document.getElementById('status').textContent = '‚ùå Erreur: ' + error.message;
    });
}

function afficherStations(data) {
    var container = document.getElementById('listeStations');
    if (!data) {
        container.innerHTML = '<p style="text-align:center;padding:1rem;color:#999;">Aucune station. Ajoutez-en une !</p>';
        return;
    }
    var stations = Object.values(data);
    var html = '';
    for (var i = 0; i < stations.length; i++) {
        var s = stations[i];
        var badgeClass = 'badge-' + s.status;
        var badgeText = s.status === 'available' ? 'Disponible' : s.status === 'limited' ? 'Stock limit√©' : 'Rupture';
        html += '<div class="station">';
        html += '<div class="station-name">' + s.name + '</div>';
        html += '<span class="status-badge ' + badgeClass + '">' + badgeText + '</span>';
        html += '<div class="station-address">üìç ' + s.address + '</div>';
        html += '<div class="station-btns">';
        html += '<button class="btn-status btn-available' + (s.status === 'available' ? ' active' : '') + '" onclick="changerStatut(\'' + s.id + '\', \'available\')">‚úÖ</button>';
        html += '<button class="btn-status btn-limited' + (s.status === 'limited' ? ' active' : '') + '" onclick="changerStatut(\'' + s.id + '\', \'limited\')">‚ö†Ô∏è</button>';
        html += '<button class="btn-status btn-unavailable' + (s.status === 'unavailable' ? ' active' : '') + '" onclick="changerStatut(\'' + s.id + '\', \'unavailable\')">‚ùå</button>';
        html += '<button class="btn-delete" onclick="supprimerStation(\'' + s.id + '\')">üóëÔ∏è</button>';
        html += '</div></div>';
    }
    container.innerHTML = html;
}

function ajouterStation() {
    var nom = document.getElementById('nom').value.trim();
    var adresse = document.getElementById('adresse').value.trim();
    var lat = parseFloat(document.getElementById('lat').value);
    var lng = parseFloat(document.getElementById('lng').value);
    var statut = document.getElementById('statut').value;
    if (!nom || !adresse) { alert('Remplissez le nom et l\'adresse !'); return; }
    if (isNaN(lat) || isNaN(lng)) { alert('Coordonn√©es invalides !'); return; }
    var id = 'station_' + Date.now();
    var station = { id: id, name: nom, address: adresse, lat: lat, lng: lng, status: statut, updatedAt: Date.now() };
    db.ref('stations/' + id).set(station).then(function() {
        afficherToast('‚úÖ Station ajout√©e !');
        document.getElementById('nom').value = '';
        document.getElementById('adresse').value = '';
        document.getElementById('lat').value = '';
        document.getElementById('lng').value = '';
    }).catch(function(error) { alert('Erreur: ' + error.message); });
}

function changerStatut(id, statut) {
    db.ref('stations/' + id).update({ status: statut, updatedAt: Date.now() })
    .then(function() { afficherToast('‚úÖ Statut mis √† jour !'); })
    .catch(function(e) { alert('Erreur: ' + e.message); });
}

function supprimerStation(id) {
    if (confirm('Supprimer cette station ?')) {
        db.ref('stations/' + id).remove()
        .then(function() { afficherToast('‚úÖ Station supprim√©e !'); })
        .catch(function(e) { alert('Erreur: ' + e.message); });
    }
}

function afficherToast(msg) {
    var toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = msg;
    document.body.appendChild(toast);
    setTimeout(function() { toast.remove(); }, 3000);
}
</script>

</body>
</html>